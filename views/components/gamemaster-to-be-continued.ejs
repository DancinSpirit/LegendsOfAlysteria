<div id = "turn-title">
    <p class="boxtext big-boy big-boy-turn-title"></p>
    <div id="title-box-turn-title">
        <p class="boxtext turn-title">What do you want to do?</p>
        <p id="new-event-button" class="boxtext event-create-choice">Insert New Event</p>
        <p id="new-ruler-phase" class="boxtext event-create-choice">Insert New Ruler Phase</p>
        <p class="boxtext event-create-choice">Insert New Region Phase</p>
        <p class="boxtext event-create-choice">Go To Next Season</p>
    </div>
    <p class="boxtext big-boy big-boy-turn-title"></p>
</div> 
<div class = "height-box">

</div>
<script>
    $("#left-arrow-box").removeClass("invisible");
    $("#top-arrow-box").removeClass("invisible");
    $("#right-arrow-box").addClass("invisible");
    $("#gamemaster-tab").removeClass("unselected")
    $("#gamemaster-tab").removeClass("invisible");
    $("#contents-tab").addClass("unselected");
    $("#contents-tab").removeClass("invisible");
    $("#story-tab").addClass("unselected")
    $("#left-arrow-box").off("click");
    $("#left-arrow-box").on("click", function(){
        states = ["story","event"];
        let year = story.years[story.years.length-1]
        let season = year.seasons[year.seasons.length-1]
        let regionPhase = season.regionPhases[season.regionPhases.length-1]
        let rulerPhase = regionPhase.rulerPhases[regionPhase.rulerPhases.length-1]
        let event = rulerPhase.events[rulerPhase.events.length-1];
        let alreadyExists = false;
            for(let x=0; x<databaseObjects[1].length; x++){
                if(databaseObjects[1][x].name=="Event"){
                    alreadyExists = true;
                    databaseObjects[1][x].id = event;
                }
            }
            if(!alreadyExists){
                databaseObjects[1].push({name:"Event",id:event})
            }
        loadState(1,"right");
        states = ["story","to-be-continued"];
    })
    buttons.newEventButton = function(){
        $("#new-event-button").on("click", async function(){
            let newEvent = await createDatabaseObject("Event",{title: "New Event",subtitle: "Event Subtitle",type: "Event Type",text:["New Event Text!"],background:"Book",startingMusic:"none"})
            customData[1].eventIndex++;
            story.years.at(customData[1].year).seasons.at(customData[1].season).regionPhases.at(customData[1].regionPhase).rulerPhases.at(customData[1].rulerPhase).events.splice(customData[1].eventIndex, 0, newEvent._id)
            updateStory(story._id,"$set","years.$[].seasons.$[].regionPhases.$[].rulerPhases.$[rulerPhase].events",story.years.at(customData[1].year).seasons.at(customData[1].season).regionPhases.at(customData[1].regionPhase).rulerPhases.at(customData[1].rulerPhase).events,{arrayFilters:[{"rulerPhase._id": story.years.at(customData[1].year).seasons.at(customData[1].season).regionPhases.at(customData[1].regionPhase).rulerPhases.at(customData[1].rulerPhase)._id}]});
            states[1] = "event";
            window.history.pushState({states:states,databaseObjects: databaseObjects,customData:customData}, "Story Event", "/story/event");
            window.location.reload();
        })
    }
    buttons.newRulerPhase = function(){
        $("#new-ruler-phase").on("click", async function(){
            let newEvent = await createDatabaseObject("Event",{title: "New Event",subtitle: "Event Subtitle",type: "Event Type",text:["New Event Text!"],background:"Book",startingMusic:"none"})
            customData[1].rulerPhase++;
            customData[1].eventIndex = 0;
            story.years.at(customData[1].year).seasons.at(customData[1].season).regionPhases.at(customData[1].regionPhase).rulerPhases.splice(customData[1].rulerPhase,0,{
                name: "Ruler",
                progress: {
                    finished: false,
                    edited: false,
                    completed: false
                },
                events: [newEvent._id]
            });
            updateStory(story._id,"$set","years.$[].seasons.$[].regionPhases.$[regionPhase].rulerPhases",story.years.at(customData[1].year).seasons.at(customData[1].season).regionPhases.at(customData[1].regionPhase).rulerPhases,{arrayFilters:[{"regionPhase._id": story.years.at(customData[1].year).seasons.at(customData[1].season).regionPhases.at(customData[1].regionPhase)._id}]})
            states[1] = "player-title"
            window.history.pushState({states:states,databaseObjects: databaseObjects,customData:customData}, "Story Player Title", "/story/player-title");
            window.location.reload();
        })
    }
    buttons.newRegionPhase = function(){
        $("#new-region-phase").on("click", async function(){
            let newEvent = await createDatabaseObject("Event",{title: "New Event",subtitle: "Event Subtitle",type: "Event Type",text:["New Event Text!"],background:"Book",startingMusic:"none"})
            customData[1].regionPhase++;
            customData[1].rulerPhase = 0;
            customData[1].eventIndex = 0;
            story.years.at(customData[1].year).seasons.at(customData[1].season).regionPhases.at(customData[1].regionPhase).splice(customData[1].regionPhase,0,{
                name: "Region",
                emblem: "https://cdn.discordapp.com/attachments/948762262829666325/973352327274692658/alysteria.png",
                players: [],
                rulerPhases: [{
                    name: "Ruler",
                    events: [newEvent._id]
                }]
            });
            updateStory(story._id,"$set","years.$[].seasons.$[].regionPhases.$[regionPhase].rulerPhases",story.years.at(customData[1].year).seasons.at(customData[1].season).regionPhases.at(customData[1].regionPhase).rulerPhases,{arrayFilters:[{"regionPhase._id": story.years.at(customData[1].year).seasons.at(customData[1].season).regionPhases.at(customData[1].regionPhase)._id}]})
            states[1] = "region-title"
            window.history.pushState({states:states,databaseObjects: databaseObjects,customData:customData}, "Story Region Title", "/story/region-title");
            window.location.reload();
        })
    }
    buttons.newEventButton();   
    buttons.newRulerPhase();
</script>
<background>https://media.discordapp.net/attachments/948762262829666325/948765394330595388/Book.jpg</background>